<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teso</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <canvas id="gameCanvas" width="1280" height="720"></canvas>
    <script>
        var canvas, canvasContext;
        var playerX = 640,
            playerY = 370,
            playerW = 20,
            playerH = 20,
            playerSpeedX = 0,
            playerSpeedY = 0;
        var mouseX = 0,
            mouseY = 0;
        var bullets = [];
        var bulletSpeed = 5;
        var KEY_W = 87,
            KEY_A = 65,
            KEY_S = 83,
            KEY_D = 68
        var keyHeld_Down = false,
            keyHeld_Up = false,
            keyHeld_Left = false,
            keyHeld_Right = false,
            keyHeld_Shoot = false;
        window.onload = function() {
            // Canvas elem kiválasztása és kontextus létrehozása
            canvas = document.getElementById('gameCanvas');
            canvasContext = canvas.getContext('2d');
            var framesPerSecond = 60;
            // Időzítő beállítása az update és draw függvényeknek
            setInterval(function() {
                moveEverything();
                drawEverything();
            }, 1000 / framesPerSecond);
            // Egérmozgás és billentyű lenyomás
            canvas.addEventListener('mousemove', updateMousePos);
            canvas.addEventListener('mousedown', mousePressed);
            document.addEventListener('keydown', keyPressed);
            document.addEventListener('keyup', keyReleased);
        }
        function updateMousePos(evt) {
            // Egér pozíciójának frissítése
            var rect = canvas.getBoundingClientRect();
            var root = document.documentElement;
            mouseX = evt.clientX - rect.left - root.scrollLeft;
            mouseY = evt.clientY - rect.top - root.scrollTop;
        }
        function mousePressed(evt) {
            // Egérgomb lenyomása
            keyHeld_Shoot = true;
        }
         function mouseReleased(evt) {
              // Egérgomb felengedése
             if (evt.mousePressed) {
                 keyHeld_Shoot = false;
                 bulletSpeed == 0;
             }
         }
        function keyPressed(evt) {
            // Billentyű lenyomásának érzékelése
            if (evt.keyCode == KEY_A) {
                keyHeld_Left = true;
            }
            if (evt.keyCode == KEY_D) {
                keyHeld_Right = true;
            }
            if (evt.keyCode == KEY_W) {
                keyHeld_Up = true;
            }
            if (evt.keyCode == KEY_S) {
                keyHeld_Down = true;
            }
        }
        function keyReleased(evt) {
            // Billentyű felengedése
            if (evt.keyCode == KEY_A) {
                keyHeld_Left = false;
                playerSpeedX = 0;
            }
            if (evt.keyCode == KEY_D) {
                keyHeld_Right = false;
                playerSpeedX = 0;
            }
            if (evt.keyCode == KEY_W) {
                keyHeld_Up = false;
                playerSpeedY = 0;
            }
            if (evt.keyCode == KEY_S) {
                keyHeld_Down = false;
                playerSpeedY = 0;
            }
            if (evt.keyCode == KEY_SPACE) {
                keyHeld_Shoot = false;
            }
        }
        function moveEverything() {
            // Játékos és lövedékek mozgatása
            playerX += playerSpeedX;
            playerY += playerSpeedY;

            if (keyHeld_Up) {
                playerSpeedY = -7;
            }
            if (keyHeld_Down) {
                playerSpeedY = 7;
            }
            if (keyHeld_Left) {
                playerSpeedX = -7;
            }
            if (keyHeld_Right) {
                playerSpeedX = 7;
            }
            // Határok ellenőrzése és lövés indítása
            if (playerX >= canvas.width - playerW) {
                playerX = canvas.width - playerW;
            }
            if (playerX <= 0) {
                playerX = 0;
            }
            if (playerY <= 0) {
                playerY = 0;
            }
            if (playerY >= canvas.height - playerH) {
                playerY = canvas.height - playerH;
            }
            if (keyHeld_Shoot) {
                var bullet = {
                    x: playerX,
                    y: playerY,
                    size: 5,
                    vx: (mouseX - playerX) / 10,
                    vy: (mouseY - playerY) / 10
                };
                bullets.push(bullet);
            }
            // Lövedékek mozgatása és határok ellenőrzése
            for (var i = 0; i < bullets.length; i++) {
                var bullet = bullets[i];
                bullet.x += bullet.vx;
                bullet.y += bullet.vy;

                if (bullet.x < 0 || bullet.x > canvas.width || bullet.y < 0 || bullet.y > canvas.height) {
                    bullets.splice(i, 1);
                    i--;
                }
            }
        }
        function drawEverything() {
            // Minden kirajzolása
            canvasContext.fillStyle = 'black';
            canvasContext.fillRect(0, 0, canvas.width, canvas.height);

            // Játékos kirajzolása
            canvasContext.fillStyle = 'red';
            canvasContext.fillRect(playerX, playerY, playerW, playerH);

            // Lövedékek kirajzolása
            canvasContext.fillStyle = 'white';
            for (var i = 0; i < bullets.length; i++) {
                var bullet = bullets[i];
                canvasContext.fillRect(bullet.x - bullet.size / 2, bullet.y - bullet.size / 2, bullet.size, bullet.size);
            }
            // Szöveg megjelenítése
            canvasContext.fillStyle = 'grey';
            canvasContext.fillText("Irányítás: W-A-S-D", 10, canvas.height - 10);
        }
    </script>
</body>
</html>
